<p>I used <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener">typescript</a> now for the second time in a commercial project, yet I had not learned it ‘by the book’ and getting to the bottom of it. On the other hand there was serious work to do on the <a href="https://github.com/sebs/etherscan-api" target="_blank" rel="noopener">etherscan-api</a> project and I was able to put the 100 plus hours into the next version of etherscan api, rewritten in typescript.</p>
<h2 id="Why-do-a-refactoring-at-all"><a href="#Why-do-a-refactoring-at-all" class="headerlink" title="Why do a refactoring at all"></a>Why do a refactoring at all</h2><p>The etherscan-api client has seen about 43K Downloads in 63 versions so far and there have not been many changes. Earlier this year I killed a lot of other open source projects (about 300+ repositories) and moved them to cold storage in order to allow more focus on those left.</p>
<p>For sure, there was a lack of documentation. I wanted to match the docs at <a href="https://etherscan.io/apis" target="_blank" rel="noopener">etherscan.io/apis</a> as much as possible. What was missing there was a set of examples and not really api docs. These have been added now in form of a vue.js example application that will be filled with examples one by one.</p>
<p>In general a goal of the refactoring (while keeping the outside api stable), was to provide a npm module usable in typescript, node.js and as a browser package. The later 2 should be provided by the already  version, but browser packages are not  reliably generated and there is no use in typescript yet.</p>
<p>I think learning by doing is a good thing and my practical experience with typescript made me confident to be able to provide working code and a improvement to the already shipped code base. As I stated before: Api should be stable after release but the rest is up to learning and refactoring.</p>
<p>One shortcoming of the old release was the missing set of fixtures and mocked api calls. Every test hit the API and that made releases unstable at best. The used mocha test framework can be configured to do test repeats on failing tests and has configurable timeouts, but that is not fixing the main issue of depending on external servers for development.</p>
<p>The project now has a certain age, and I’d rather do things right than much longer half way. Tests, API docs and Examples must all be there. Developers new to the project should be able to grasp everything easily and not be required to read the (pretty readable) source code to find out how things work.</p>
<p>So there was need for a bit of refactoring</p>
<h2 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h2><p>I had some assumptions when I started out</p>
<ul>
<li>typescript will speed up the process</li>
<li>ava ts will speed up many tests</li>
<li>putting everything in a monorepo makes sense, as there are many little use cases and features that would clutter the main repository</li>
</ul>
<h2 id="Learnings"><a href="#Learnings" class="headerlink" title="Learnings"></a>Learnings</h2><ul>
<li>ava is pretty slow, once you have many tests</li>
<li>lots of different tools make it hard </li>
<li>Working on all the infrastructure is costly</li>
<li>typescript actually does speed up development</li>
</ul>
